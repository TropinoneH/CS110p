#include <immintrin.h>
#include <omp.h>
#include <string.h>
#include <stdio.h>

void impl(int N, int step, double *p) {
    /* Your code here */
    double *temp;
    double *p_next = malloc(N * N * sizeof(double));
    memcpy(p_next, p, N * N * sizeof(double));

    int i, j, k, j_begin;
    int stp = step / 4;
    for (k = 0; k < stp; ++k) {
#pragma omp parallel for
        for (i = 4; i < N - 4; i++) {
            for (j = 4 + (0 ^ (i & 1)); j < N - 4; j += 2) {
                p_next[i * N + j] = 0.00390625 * (p[(i - 4) * N + (j)] + p[(i) * N + (j - 4)] + p[(i) * N + (j + 4)] + p[(i + 4) * N + (j)]) +
                                    0.015625 * (p[(i - 3) * N + (j - 1)] + p[(i - 3) * N + (j + 1)] + p[(i - 1) * N + (j - 3)] + p[(i - 1) * N + (j + 3)] +
                                                p[(i + 1) * N + (j - 3)] + p[(i + 1) * N + (j + 3)] + p[(i + 3) * N + (j - 1)] + p[(i + 3) * N + (j + 1)]) +
                                    0.0234375 * (p[(i - 2) * N + (j - 2)] + p[(i - 2) * N + (j + 2)] + p[(i + 2) * N + (j - 2)] + p[(i + 2) * N + (j + 2)]) +
                                    0.0625 * (p[(i - 2) * N + (j)] + p[(i) * N + (j - 2)] + p[(i) * N + (j + 2)] + p[(i + 2) * N + (j)]) +
                                    0.09375 * (p[(i - 1) * N + (j - 1)] + p[(i - 1) * N + (j + 1)] + p[(i + 1) * N + (j - 1)] + p[(i + 1) * N + (j + 1)]) +
                                    0.140625 * (p[(i) * N + (j)]);
            }
        }
        // 1
        p_next[N + 1] = 0.28125 * (p[(1 - 1) * N + (1)] + p[(1) * N + (1 - 1)]) + 0.08203125 * (p[(1 - 1) * N + (1 + 1)] + p[(1 + 1) * N + (1 - 1)]) +
                        0.015625 * (p[(1 - 1) * N + (1 + 2)] + p[(1 + 1) * N + (1 + 3)] + p[(1 + 2) * N + (1 - 1)] + p[(1 + 3) * N + (1 + 1)]) +
                        0.00390625 * (p[(1 - 1) * N + (1 + 3)] + p[(1) * N + (1 + 4)] + p[(1 + 3) * N + (1 - 1)] + p[(1 + 4) * N + (1)]) +
                        0.0390625 * (p[(1) * N + (1)]) + 0.03515625 * (p[(1) * N + (1 + 2)] + p[(1 + 2) * N + (1)]) + 0.0625 * (p[(1 + 1) * N + (1 + 1)]) +
                        0.0234375 * (p[(1 + 2) * N + (1 + 2)]);
        p_next[N + 2] = 0.08203125 * (p[(1 - 1) * N + (2 - 1)] + p[(1) * N + (2 - 2)]) + 0.296875 * (p[(1 - 1) * N + (2)]) +
                        0.0859375 * (p[(1 - 1) * N + (2 + 1)]) +
                        0.015625 * (p[(1 - 1) * N + (2 + 2)] + p[(1 + 1) * N + (2 + 3)] + p[(1 + 3) * N + (2 - 1)] + p[(1 + 3) * N + (2 + 1)]) +
                        0.00390625 * (p[(1 - 1) * N + (2 + 3)] + p[(1) * N + (2 + 4)] + p[(1 + 4) * N + (2)]) + 0.07421875 * (p[(1) * N + (2)]) +
                        0.0390625 * (p[(1) * N + (2 + 2)]) + 0.03125 * (p[(1 + 1) * N + (2 - 2)]) + 0.0625 * (p[(1 + 1) * N + (2 - 1)]) +
                        0.078125 * (p[(1 + 1) * N + (2 + 1)]) + 0.01171875 * (p[(1 + 2) * N + (2 - 2)]) + 0.05859375 * (p[(1 + 2) * N + (2)]) +
                        0.0234375 * (p[(1 + 2) * N + (2 + 2)]);
        p_next[N + 3] = 0.015625 * (p[(1 - 1) * N + (3 - 2)] + p[(1 - 1) * N + (3 + 2)] + p[(1) * N + (3 - 3)] + p[(1 + 1) * N + (3 + 3)] +
                                    p[(1 + 3) * N + (3 - 1)] + p[(1 + 3) * N + (3 + 1)]) +
                        0.0859375 * (p[(1 - 1) * N + (3 - 1)] + p[(1 - 1) * N + (3 + 1)]) + 0.296875 * (p[(1 - 1) * N + (3)]) +
                        0.00390625 * (p[(1 - 1) * N + (3 + 3)] + p[(1) * N + (3 + 4)] + p[(1 + 4) * N + (3)]) + 0.03515625 * (p[(1) * N + (3 - 2)]) +
                        0.078125 * (p[(1) * N + (3)] + p[(1 + 1) * N + (3 - 1)] + p[(1 + 1) * N + (3 + 1)]) + 0.0390625 * (p[(1) * N + (3 + 2)]) +
                        0.01171875 * (p[(1 + 1) * N + (3 - 3)]) + 0.0234375 * (p[(1 + 2) * N + (3 - 2)] + p[(1 + 2) * N + (3 + 2)]) +
                        0.05859375 * (p[(1 + 2) * N + (3)]);
        p_next[N + N - 4] = 0.00390625 * (p[(1 - 1) * N + (N - 4 - 3)] + p[(1) * N + (N - 4 - 4)] + p[(1 + 4) * N + (N - 4)]) +
                            0.015625 * (p[(1 - 1) * N + (N - 4 - 2)] + p[(1 - 1) * N + (N - 4 + 2)] + p[(1) * N + (N - 4 + 3)] + p[(1 + 1) * N + (N - 4 - 3)] +
                                        p[(1 + 3) * N + (N - 4 - 1)] + p[(1 + 3) * N + (N - 4 + 1)]) +
                            0.0859375 * (p[(1 - 1) * N + (N - 4 - 1)] + p[(1 - 1) * N + (N - 4 + 1)]) + 0.296875 * (p[(1 - 1) * N + (N - 4)]) +
                            0.0390625 * (p[(1) * N + (N - 4 - 2)]) +
                            0.078125 * (p[(1) * N + (N - 4)] + p[(1 + 1) * N + (N - 4 - 1)] + p[(1 + 1) * N + (N - 4 + 1)]) +
                            0.03515625 * (p[(1) * N + (N - 4 + 2)]) + 0.01171875 * (p[(1 + 1) * N + (N - 4 + 3)]) +
                            0.0234375 * (p[(1 + 2) * N + (N - 4 - 2)] + p[(1 + 2) * N + (N - 4 + 2)]) + 0.05859375 * (p[(1 + 2) * N + (N - 4)]);
        p_next[N + N - 3] =
                0.00390625 * (p[(1 - 1) * N + (N - 3 - 3)] + p[(1) * N + (N - 3 - 4)] + p[(1 + 4) * N + (N - 3)]) +
                0.015625 * (p[(1 - 1) * N + (N - 3 - 2)] + p[(1 + 1) * N + (N - 3 - 3)] + p[(1 + 3) * N + (N - 3 - 1)] + p[(1 + 3) * N + (N - 3 + 1)]) +
                0.0859375 * (p[(1 - 1) * N + (N - 3 - 1)]) + 0.296875 * (p[(1 - 1) * N + (N - 3)]) +
                0.08203125 * (p[(1 - 1) * N + (N - 3 + 1)] + p[(1) * N + (N - 3 + 2)]) + 0.0390625 * (p[(1) * N + (N - 3 - 2)]) +
                0.07421875 * (p[(1) * N + (N - 3)]) + 0.078125 * (p[(1 + 1) * N + (N - 3 - 1)]) + 0.0625 * (p[(1 + 1) * N + (N - 3 + 1)]) +
                0.03125 * (p[(1 + 1) * N + (N - 3 + 2)]) + 0.0234375 * (p[(1 + 2) * N + (N - 3 - 2)]) + 0.05859375 * (p[(1 + 2) * N + (N - 3)]) +
                0.01171875 * (p[(1 + 2) * N + (N - 3 + 2)]);
        p_next[N + N - 2] =
                0.00390625 * (p[(1 - 1) * N + (N - 2 - 3)] + p[(1) * N + (N - 2 - 4)] + p[(1 + 3) * N + (N - 2 + 1)] + p[(1 + 4) * N + (N - 2)]) +
                0.015625 * (p[(1 - 1) * N + (N - 2 - 2)] + p[(1 + 1) * N + (N - 2 - 3)] + p[(1 + 2) * N + (N - 2 + 1)] + p[(1 + 3) * N + (N - 2 - 1)]) +
                0.08203125 * (p[(1 - 1) * N + (N - 2 - 1)] + p[(1 + 1) * N + (N - 2 + 1)]) + 0.28125 * (p[(1 - 1) * N + (N - 2)] + p[(1) * N + (N - 2 + 1)]) +
                0.03515625 * (p[(1) * N + (N - 2 - 2)] + p[(1 + 2) * N + (N - 2)]) + 0.0390625 * (p[(1) * N + (N - 2)]) +
                0.0625 * (p[(1 + 1) * N + (N - 2 - 1)]) + 0.0234375 * (p[(1 + 2) * N + (N - 2 - 2)]);

        // 2
        p_next[2 * N + 1] = 0.08203125 * (p[(2 - 2) * N + (1)] + p[(2 - 1) * N + (1 - 1)]) + 0.03125 * (p[(2 - 2) * N + (1 + 1)]) +
                            0.01171875 * (p[(2 - 2) * N + (1 + 2)]) + 0.0625 * (p[(2 - 1) * N + (1 + 1)]) +
                            0.015625 * (p[(2 - 1) * N + (1 + 3)] + p[(2 + 1) * N + (1 + 3)] + p[(2 + 2) * N + (1 - 1)] + p[(2 + 3) * N + (1 + 1)]) +
                            0.296875 * (p[(2) * N + (1 - 1)]) + 0.07421875 * (p[(2) * N + (1)]) + 0.05859375 * (p[(2) * N + (1 + 2)]) +
                            0.00390625 * (p[(2) * N + (1 + 4)] + p[(2 + 3) * N + (1 - 1)] + p[(2 + 4) * N + (1)]) + 0.0859375 * (p[(2 + 1) * N + (1 - 1)]) +
                            0.078125 * (p[(2 + 1) * N + (1 + 1)]) + 0.0390625 * (p[(2 + 2) * N + (1)]) + 0.0234375 * (p[(2 + 2) * N + (1 + 2)]);
        p_next[2 * N + 2] = 0.03125 * (p[(2 - 2) * N + (2 - 1)] + p[(2 - 2) * N + (2 + 1)] + p[(2 - 1) * N + (2 - 2)] + p[(2 + 1) * N + (2 - 2)]) +
                            0.09375 * (p[(2 - 2) * N + (2)] + p[(2) * N + (2 - 2)] + p[(2 + 1) * N + (2 + 1)]) +
                            0.01171875 * (p[(2 - 2) * N + (2 + 2)] + p[(2 + 2) * N + (2 - 2)]) +
                            0.0625 * (p[(2 - 1) * N + (2 - 1)] + p[(2) * N + (2 + 2)] + p[(2 + 2) * N + (2)]) +
                            0.078125 * (p[(2 - 1) * N + (2 + 1)] + p[(2 + 1) * N + (2 - 1)]) +
                            0.015625 * (p[(2 - 1) * N + (2 + 3)] + p[(2 + 1) * N + (2 + 3)] + p[(2 + 3) * N + (2 - 1)] + p[(2 + 3) * N + (2 + 1)]) +
                            0.1328125 * (p[(2) * N + (2)]) + 0.00390625 * (p[(2) * N + (2 + 4)] + p[(2 + 4) * N + (2)]) +
                            0.0234375 * (p[(2 + 2) * N + (2 + 2)]);
        p_next[2 * N + 3] =
                0.01171875 * (p[(2 - 2) * N + (3 - 2)] + p[(2 - 2) * N + (3 + 2)] + p[(2 - 1) * N + (3 - 3)] + p[(2 + 1) * N + (3 - 3)]) +
                0.03125 * (p[(2 - 2) * N + (3 - 1)] + p[(2 - 2) * N + (3 + 1)]) +
                0.09375 * (p[(2 - 2) * N + (3)] + p[(2 + 1) * N + (3 - 1)] + p[(2 + 1) * N + (3 + 1)]) +
                0.078125 * (p[(2 - 1) * N + (3 - 1)] + p[(2 - 1) * N + (3 + 1)]) +
                0.015625 * (p[(2 - 1) * N + (3 + 3)] + p[(2) * N + (3 - 3)] + p[(2 + 1) * N + (3 + 3)] + p[(2 + 3) * N + (3 - 1)] + p[(2 + 3) * N + (3 + 1)]) +
                0.05859375 * (p[(2) * N + (3 - 2)]) + 0.13671875 * (p[(2) * N + (3)]) + 0.0625 * (p[(2) * N + (3 + 2)] + p[(2 + 2) * N + (3)]) +
                0.00390625 * (p[(2) * N + (3 + 4)] + p[(2 + 4) * N + (3)]) + 0.0234375 * (p[(2 + 2) * N + (3 - 2)] + p[(2 + 2) * N + (3 + 2)]);
        p_next[2 * N + N - 4] =
                0.01171875 * (p[(2 - 2) * N + (N - 4 - 2)] + p[(2 - 2) * N + (N - 4 + 2)] + p[(2 - 1) * N + (N - 4 + 3)] + p[(2 + 1) * N + (N - 4 + 3)]) +
                0.03125 * (p[(2 - 2) * N + (N - 4 - 1)] + p[(2 - 2) * N + (N - 4 + 1)]) +
                0.09375 * (p[(2 - 2) * N + (N - 4)] + p[(2 + 1) * N + (N - 4 - 1)] + p[(2 + 1) * N + (N - 4 + 1)]) +
                0.015625 * (p[(2 - 1) * N + (N - 4 - 3)] + p[(2) * N + (N - 4 + 3)] + p[(2 + 1) * N + (N - 4 - 3)] + p[(2 + 3) * N + (N - 4 - 1)] +
                            p[(2 + 3) * N + (N - 4 + 1)]) +
                0.078125 * (p[(2 - 1) * N + (N - 4 - 1)] + p[(2 - 1) * N + (N - 4 + 1)]) + 0.00390625 * (p[(2) * N + (N - 4 - 4)] + p[(2 + 4) * N + (N - 4)]) +
                0.0625 * (p[(2) * N + (N - 4 - 2)] + p[(2 + 2) * N + (N - 4)]) + 0.13671875 * (p[(2) * N + (N - 4)]) + 0.05859375 * (p[(2) * N + (N - 4 + 2)]) +
                0.0234375 * (p[(2 + 2) * N + (N - 4 - 2)] + p[(2 + 2) * N + (N - 4 + 2)]);
        p_next[2 * N + N - 3] =
                0.01171875 * (p[(2 - 2) * N + (N - 3 - 2)] + p[(2 + 2) * N + (N - 3 + 2)]) +
                0.03125 * (p[(2 - 2) * N + (N - 3 - 1)] + p[(2 - 2) * N + (N - 3 + 1)] + p[(2 - 1) * N + (N - 3 + 2)] + p[(2 + 1) * N + (N - 3 + 2)]) +
                0.09375 * (p[(2 - 2) * N + (N - 3)] + p[(2) * N + (N - 3 + 2)] + p[(2 + 1) * N + (N - 3 - 1)]) +
                0.015625 * (p[(2 - 1) * N + (N - 3 - 3)] + p[(2 + 1) * N + (N - 3 - 3)] + p[(2 + 3) * N + (N - 3 - 1)] + p[(2 + 3) * N + (N - 3 + 1)]) +
                0.078125 * (p[(2 - 1) * N + (N - 3 - 1)] + p[(2 + 1) * N + (N - 3 + 1)]) +
                0.0625 * (p[(2 - 1) * N + (N - 3 + 1)] + p[(2) * N + (N - 3 - 2)] + p[(2 + 2) * N + (N - 3)]) +
                0.00390625 * (p[(2) * N + (N - 3 - 4)] + p[(2 + 4) * N + (N - 3)]) + 0.1328125 * (p[(2) * N + (N - 3)]) +
                0.0234375 * (p[(2 + 2) * N + (N - 3 - 2)]);
        p_next[2 * N + N - 2] =
                0.01171875 * (p[(2 - 2) * N + (N - 2 - 2)]) + 0.03125 * (p[(2 - 2) * N + (N - 2 - 1)]) +
                0.08203125 * (p[(2 - 2) * N + (N - 2)] + p[(2 - 1) * N + (N - 2 + 1)]) +
                0.015625 * (p[(2 - 1) * N + (N - 2 - 3)] + p[(2 + 1) * N + (N - 2 - 3)] + p[(2 + 2) * N + (N - 2 + 1)] + p[(2 + 3) * N + (N - 2 - 1)]) +
                0.0625 * (p[(2 - 1) * N + (N - 2 - 1)]) + 0.00390625 * (p[(2) * N + (N - 2 - 4)] + p[(2 + 3) * N + (N - 2 + 1)] + p[(2 + 4) * N + (N - 2)]) +
                0.05859375 * (p[(2) * N + (N - 2 - 2)]) + 0.07421875 * (p[(2) * N + (N - 2)]) + 0.296875 * (p[(2) * N + (N - 2 + 1)]) +
                0.078125 * (p[(2 + 1) * N + (N - 2 - 1)]) + 0.0859375 * (p[(2 + 1) * N + (N - 2 + 1)]) + 0.0234375 * (p[(2 + 2) * N + (N - 2 - 2)]) +
                0.0390625 * (p[(2 + 2) * N + (N - 2)]);

        // 3
        p_next[3 * N + 1] = 0.015625 * (p[(3 - 3) * N + (1)] + p[(3 - 2) * N + (1 - 1)] + p[(3 - 1) * N + (1 + 3)] + p[(3 + 1) * N + (1 + 3)] +
                                        p[(3 + 2) * N + (1 - 1)] + p[(3 + 3) * N + (1 + 1)]) +
                            0.01171875 * (p[(3 - 3) * N + (1 + 1)]) + 0.03515625 * (p[(3 - 2) * N + (1)]) +
                            0.0234375 * (p[(3 - 2) * N + (1 + 2)] + p[(3 + 2) * N + (1 + 2)]) +
                            0.0859375 * (p[(3 - 1) * N + (1 - 1)] + p[(3 + 1) * N + (1 - 1)]) +
                            0.078125 * (p[(3 - 1) * N + (1 + 1)] + p[(3) * N + (1)] + p[(3 + 1) * N + (1 + 1)]) + 0.296875 * (p[(3) * N + (1 - 1)]) +
                            0.05859375 * (p[(3) * N + (1 + 2)]) + 0.00390625 * (p[(3) * N + (1 + 4)] + p[(3 + 3) * N + (1 - 1)] + p[(3 + 4) * N + (1)]) +
                            0.0390625 * (p[(3 + 2) * N + (1)]);
        p_next[3 * N + 2] =
                0.01171875 * (p[(3 - 3) * N + (2 - 1)] + p[(3 - 3) * N + (2 + 1)] + p[(3 - 2) * N + (2 - 2)] + p[(3 + 2) * N + (2 - 2)]) +
                0.015625 * (p[(3 - 3) * N + (2)] + p[(3 - 1) * N + (2 + 3)] + p[(3 + 1) * N + (2 + 3)] + p[(3 + 3) * N + (2 - 1)] + p[(3 + 3) * N + (2 + 1)]) +
                0.05859375 * (p[(3 - 2) * N + (2)]) + 0.0234375 * (p[(3 - 2) * N + (2 + 2)] + p[(3 + 2) * N + (2 + 2)]) +
                0.03125 * (p[(3 - 1) * N + (2 - 2)] + p[(3 + 1) * N + (2 - 2)]) + 0.078125 * (p[(3 - 1) * N + (2 - 1)] + p[(3 + 1) * N + (2 - 1)]) +
                0.09375 * (p[(3 - 1) * N + (2 + 1)] + p[(3) * N + (2 - 2)] + p[(3 + 1) * N + (2 + 1)]) + 0.13671875 * (p[(3) * N + (2)]) +
                0.0625 * (p[(3) * N + (2 + 2)] + p[(3 + 2) * N + (2)]) + 0.00390625 * (p[(3) * N + (2 + 4)] + p[(3 + 4) * N + (2)]);
        p_next[3 * N + 3] = 0.01171875 * (p[(3 - 3) * N + (3 - 1)] + p[(3 - 3) * N + (3 + 1)] + p[(3 - 1) * N + (3 - 3)] + p[(3 + 1) * N + (3 - 3)]) +
                            0.015625 * (p[(3 - 3) * N + (3)] + p[(3 - 1) * N + (3 + 3)] + p[(3) * N + (3 - 3)] + p[(3 + 1) * N + (3 + 3)] +
                                        p[(3 + 3) * N + (3 - 1)] + p[(3 + 3) * N + (3 + 1)]) +
                            0.0234375 * (p[(3 - 2) * N + (3 - 2)] + p[(3 - 2) * N + (3 + 2)] + p[(3 + 2) * N + (3 - 2)] + p[(3 + 2) * N + (3 + 2)]) +
                            0.05859375 * (p[(3 - 2) * N + (3)] + p[(3) * N + (3 - 2)]) +
                            0.09375 * (p[(3 - 1) * N + (3 - 1)] + p[(3 - 1) * N + (3 + 1)] + p[(3 + 1) * N + (3 - 1)] + p[(3 + 1) * N + (3 + 1)]) +
                            0.140625 * (p[(3) * N + (3)]) + 0.0625 * (p[(3) * N + (3 + 2)] + p[(3 + 2) * N + (3)]) +
                            0.00390625 * (p[(3) * N + (3 + 4)] + p[(3 + 4) * N + (3)]);
        p_next[3 * N + N - 4] =
                0.01171875 * (p[(3 - 3) * N + (N - 4 - 1)] + p[(3 - 3) * N + (N - 4 + 1)] + p[(3 - 1) * N + (N - 4 + 3)] + p[(3 + 1) * N + (N - 4 + 3)]) +
                0.015625 * (p[(3 - 3) * N + (N - 4)] + p[(3 - 1) * N + (N - 4 - 3)] + p[(3) * N + (N - 4 + 3)] + p[(3 + 1) * N + (N - 4 - 3)] +
                            p[(3 + 3) * N + (N - 4 - 1)] + p[(3 + 3) * N + (N - 4 + 1)]) +
                0.0234375 * (p[(3 - 2) * N + (N - 4 - 2)] + p[(3 - 2) * N + (N - 4 + 2)] + p[(3 + 2) * N + (N - 4 - 2)] + p[(3 + 2) * N + (N - 4 + 2)]) +
                0.05859375 * (p[(3 - 2) * N + (N - 4)] + p[(3) * N + (N - 4 + 2)]) +
                0.09375 * (p[(3 - 1) * N + (N - 4 - 1)] + p[(3 - 1) * N + (N - 4 + 1)] + p[(3 + 1) * N + (N - 4 - 1)] + p[(3 + 1) * N + (N - 4 + 1)]) +
                0.00390625 * (p[(3) * N + (N - 4 - 4)] + p[(3 + 4) * N + (N - 4)]) + 0.0625 * (p[(3) * N + (N - 4 - 2)] + p[(3 + 2) * N + (N - 4)]) +
                0.140625 * (p[(3) * N + (N - 4)]);
        p_next[3 * N + N - 3] =
                0.01171875 * (p[(3 - 3) * N + (N - 3 - 1)] + p[(3 - 3) * N + (N - 3 + 1)] + p[(3 - 2) * N + (N - 3 + 2)] + p[(3 + 2) * N + (N - 3 + 2)]) +
                0.015625 * (p[(3 - 3) * N + (N - 3)] + p[(3 - 1) * N + (N - 3 - 3)] + p[(3 + 1) * N + (N - 3 - 3)] + p[(3 + 3) * N + (N - 3 - 1)] +
                            p[(3 + 3) * N + (N - 3 + 1)]) +
                0.0234375 * (p[(3 - 2) * N + (N - 3 - 2)] + p[(3 + 2) * N + (N - 3 - 2)]) + 0.05859375 * (p[(3 - 2) * N + (N - 3)]) +
                0.09375 * (p[(3 - 1) * N + (N - 3 - 1)] + p[(3) * N + (N - 3 + 2)] + p[(3 + 1) * N + (N - 3 - 1)]) +
                0.078125 * (p[(3 - 1) * N + (N - 3 + 1)] + p[(3 + 1) * N + (N - 3 + 1)]) +
                0.03125 * (p[(3 - 1) * N + (N - 3 + 2)] + p[(3 + 1) * N + (N - 3 + 2)]) + 0.00390625 * (p[(3) * N + (N - 3 - 4)] + p[(3 + 4) * N + (N - 3)]) +
                0.0625 * (p[(3) * N + (N - 3 - 2)] + p[(3 + 2) * N + (N - 3)]) + 0.13671875 * (p[(3) * N + (N - 3)]);
        p_next[3 * N + N - 2] = 0.01171875 * (p[(3 - 3) * N + (N - 2 - 1)]) +
                                0.015625 * (p[(3 - 3) * N + (N - 2)] + p[(3 - 2) * N + (N - 2 + 1)] + p[(3 - 1) * N + (N - 2 - 3)] +
                                            p[(3 + 1) * N + (N - 2 - 3)] + p[(3 + 2) * N + (N - 2 + 1)] + p[(3 + 3) * N + (N - 2 - 1)]) +
                                0.0234375 * (p[(3 - 2) * N + (N - 2 - 2)] + p[(3 + 2) * N + (N - 2 - 2)]) + 0.03515625 * (p[(3 - 2) * N + (N - 2)]) +
                                0.078125 * (p[(3 - 1) * N + (N - 2 - 1)] + p[(3) * N + (N - 2)] + p[(3 + 1) * N + (N - 2 - 1)]) +
                                0.0859375 * (p[(3 - 1) * N + (N - 2 + 1)] + p[(3 + 1) * N + (N - 2 + 1)]) +
                                0.00390625 * (p[(3) * N + (N - 2 - 4)] + p[(3 + 3) * N + (N - 2 + 1)] + p[(3 + 4) * N + (N - 2)]) +
                                0.05859375 * (p[(3) * N + (N - 2 - 2)]) + 0.296875 * (p[(3) * N + (N - 2 + 1)]) + 0.0390625 * (p[(3 + 2) * N + (N - 2)]);

        // N - 4
        p_next[(N - 4) * N + 1] = 0.00390625 * (p[(N - 4 - 4) * N + (1)] + p[(N - 4 - 3) * N + (1 - 1)] + p[(N - 4) * N + (1 + 4)]) +
                                  0.015625 * (p[(N - 4 - 3) * N + (1 + 1)] + p[(N - 4 - 2) * N + (1 - 1)] + p[(N - 4 - 1) * N + (1 + 3)] +
                                              p[(N - 4 + 1) * N + (1 + 3)] + p[(N - 4 + 2) * N + (1 - 1)] + p[(N - 4 + 3) * N + (1)]) +
                                  0.0390625 * (p[(N - 4 - 2) * N + (1)]) + 0.0234375 * (p[(N - 4 - 2) * N + (1 + 2)] + p[(N - 4 + 2) * N + (1 + 2)]) +
                                  0.0859375 * (p[(N - 4 - 1) * N + (1 - 1)] + p[(N - 4 + 1) * N + (1 - 1)]) +
                                  0.078125 * (p[(N - 4 - 1) * N + (1 + 1)] + p[(N - 4) * N + (1)] + p[(N - 4 + 1) * N + (1 + 1)]) +
                                  0.296875 * (p[(N - 4) * N + (1 - 1)]) + 0.05859375 * (p[(N - 4) * N + (1 + 2)]) + 0.03515625 * (p[(N - 4 + 2) * N + (1)]) +
                                  0.01171875 * (p[(N - 4 + 3) * N + (1 + 1)]);
        p_next[(N - 4) * N + 2] =
                0.00390625 * (p[(N - 4 - 4) * N + (2)] + p[(N - 4) * N + (2 + 4)]) +
                0.015625 * (p[(N - 4 - 3) * N + (2 - 1)] + p[(N - 4 - 3) * N + (2 + 1)] + p[(N - 4 - 1) * N + (2 + 3)] + p[(N - 4 + 1) * N + (2 + 3)] +
                            p[(N - 4 + 3) * N + (2)]) +
                0.01171875 * (p[(N - 4 - 2) * N + (2 - 2)] + p[(N - 4 + 2) * N + (2 - 2)] + p[(N - 4 + 3) * N + (2 - 1)] + p[(N - 4 + 3) * N + (2 + 1)]) +
                0.0625 * (p[(N - 4 - 2) * N + (2)] + p[(N - 4) * N + (2 + 2)]) + 0.0234375 * (p[(N - 4 - 2) * N + (2 + 2)] + p[(N - 4 + 2) * N + (2 + 2)]) +
                0.03125 * (p[(N - 4 - 1) * N + (2 - 2)] + p[(N - 4 + 1) * N + (2 - 2)]) +
                0.078125 * (p[(N - 4 - 1) * N + (2 - 1)] + p[(N - 4 + 1) * N + (2 - 1)]) +
                0.09375 * (p[(N - 4 - 1) * N + (2 + 1)] + p[(N - 4) * N + (2 - 2)] + p[(N - 4 + 1) * N + (2 + 1)]) + 0.13671875 * (p[(N - 4) * N + (2)]) +
                0.05859375 * (p[(N - 4 + 2) * N + (2)]);
        p_next[(N - 4) * N + 3] =
                0.00390625 * (p[(N - 4 - 4) * N + (3)] + p[(N - 4) * N + (3 + 4)]) +
                0.015625 * (p[(N - 4 - 3) * N + (3 - 1)] + p[(N - 4 - 3) * N + (3 + 1)] + p[(N - 4 - 1) * N + (3 + 3)] + p[(N - 4) * N + (3 - 3)] +
                            p[(N - 4 + 1) * N + (3 + 3)] + p[(N - 4 + 3) * N + (3)]) +
                0.0234375 * (p[(N - 4 - 2) * N + (3 - 2)] + p[(N - 4 - 2) * N + (3 + 2)] + p[(N - 4 + 2) * N + (3 - 2)] + p[(N - 4 + 2) * N + (3 + 2)]) +
                0.0625 * (p[(N - 4 - 2) * N + (3)] + p[(N - 4) * N + (3 + 2)]) +
                0.01171875 * (p[(N - 4 - 1) * N + (3 - 3)] + p[(N - 4 + 1) * N + (3 - 3)] + p[(N - 4 + 3) * N + (3 - 1)] + p[(N - 4 + 3) * N + (3 + 1)]) +
                0.09375 * (p[(N - 4 - 1) * N + (3 - 1)] + p[(N - 4 - 1) * N + (3 + 1)] + p[(N - 4 + 1) * N + (3 - 1)] + p[(N - 4 + 1) * N + (3 + 1)]) +
                0.05859375 * (p[(N - 4) * N + (3 - 2)] + p[(N - 4 + 2) * N + (3)]) + 0.140625 * (p[(N - 4) * N + (3)]);
        p_next[(N - 4) * N + N - 4] = 0.00390625 * (p[(N - 4 - 4) * N + (N - 4)] + p[(N - 4) * N + (N - 4 - 4)]) +
                                      0.015625 * (p[(N - 4 - 3) * N + (N - 4 - 1)] + p[(N - 4 - 3) * N + (N - 4 + 1)] + p[(N - 4 - 1) * N + (N - 4 - 3)] +
                                                  p[(N - 4) * N + (N - 4 + 3)] + p[(N - 4 + 1) * N + (N - 4 - 3)] + p[(N - 4 + 3) * N + (N - 4)]) +
                                      0.0234375 * (p[(N - 4 - 2) * N + (N - 4 - 2)] + p[(N - 4 - 2) * N + (N - 4 + 2)] + p[(N - 4 + 2) * N + (N - 4 - 2)] +
                                                   p[(N - 4 + 2) * N + (N - 4 + 2)]) +
                                      0.0625 * (p[(N - 4 - 2) * N + (N - 4)] + p[(N - 4) * N + (N - 4 - 2)]) +
                                      0.09375 * (p[(N - 4 - 1) * N + (N - 4 - 1)] + p[(N - 4 - 1) * N + (N - 4 + 1)] + p[(N - 4 + 1) * N + (N - 4 - 1)] +
                                                 p[(N - 4 + 1) * N + (N - 4 + 1)]) +
                                      0.01171875 * (p[(N - 4 - 1) * N + (N - 4 + 3)] + p[(N - 4 + 1) * N + (N - 4 + 3)] + p[(N - 4 + 3) * N + (N - 4 - 1)] +
                                                    p[(N - 4 + 3) * N + (N - 4 + 1)]) +
                                      0.140625 * (p[(N - 4) * N + (N - 4)]) + 0.05859375 * (p[(N - 4) * N + (N - 4 + 2)] + p[(N - 4 + 2) * N + (N - 4)]);
        p_next[(N - 4) * N + N - 3] = 0.00390625 * (p[(N - 4 - 4) * N + (N - 3)] + p[(N - 4) * N + (N - 3 - 4)]) +
                                      0.015625 * (p[(N - 4 - 3) * N + (N - 3 - 1)] + p[(N - 4 - 3) * N + (N - 3 + 1)] + p[(N - 4 - 1) * N + (N - 3 - 3)] +
                                                  p[(N - 4 + 1) * N + (N - 3 - 3)] + p[(N - 4 + 3) * N + (N - 3)]) +
                                      0.0234375 * (p[(N - 4 - 2) * N + (N - 3 - 2)] + p[(N - 4 + 2) * N + (N - 3 - 2)]) +
                                      0.0625 * (p[(N - 4 - 2) * N + (N - 3)] + p[(N - 4) * N + (N - 3 - 2)]) +
                                      0.01171875 * (p[(N - 4 - 2) * N + (N - 3 + 2)] + p[(N - 4 + 2) * N + (N - 3 + 2)] + p[(N - 4 + 3) * N + (N - 3 - 1)] +
                                                    p[(N - 4 + 3) * N + (N - 3 + 1)]) +
                                      0.09375 * (p[(N - 4 - 1) * N + (N - 3 - 1)] + p[(N - 4) * N + (N - 3 + 2)] + p[(N - 4 + 1) * N + (N - 3 - 1)]) +
                                      0.078125 * (p[(N - 4 - 1) * N + (N - 3 + 1)] + p[(N - 4 + 1) * N + (N - 3 + 1)]) +
                                      0.03125 * (p[(N - 4 - 1) * N + (N - 3 + 2)] + p[(N - 4 + 1) * N + (N - 3 + 2)]) +
                                      0.13671875 * (p[(N - 4) * N + (N - 3)]) + 0.05859375 * (p[(N - 4 + 2) * N + (N - 3)]);
        p_next[(N - 4) * N + N - 2] =
                0.00390625 * (p[(N - 4 - 4) * N + (N - 2)] + p[(N - 4 - 3) * N + (N - 2 + 1)] + p[(N - 4) * N + (N - 2 - 4)]) +
                0.015625 * (p[(N - 4 - 3) * N + (N - 2 - 1)] + p[(N - 4 - 2) * N + (N - 2 + 1)] + p[(N - 4 - 1) * N + (N - 2 - 3)] +
                            p[(N - 4 + 1) * N + (N - 2 - 3)] + p[(N - 4 + 2) * N + (N - 2 + 1)] + p[(N - 4 + 3) * N + (N - 2)]) +
                0.0234375 * (p[(N - 4 - 2) * N + (N - 2 - 2)] + p[(N - 4 + 2) * N + (N - 2 - 2)]) + 0.0390625 * (p[(N - 4 - 2) * N + (N - 2)]) +
                0.078125 * (p[(N - 4 - 1) * N + (N - 2 - 1)] + p[(N - 4) * N + (N - 2)] + p[(N - 4 + 1) * N + (N - 2 - 1)]) +
                0.0859375 * (p[(N - 4 - 1) * N + (N - 2 + 1)] + p[(N - 4 + 1) * N + (N - 2 + 1)]) + 0.05859375 * (p[(N - 4) * N + (N - 2 - 2)]) +
                0.296875 * (p[(N - 4) * N + (N - 2 + 1)]) + 0.03515625 * (p[(N - 4 + 2) * N + (N - 2)]) + 0.01171875 * (p[(N - 4 + 3) * N + (N - 2 - 1)]);

        // N - 3
        p_next[(N - 3) * N + 1] =
                0.00390625 * (p[(N - 3 - 4) * N + (1)] + p[(N - 3 - 3) * N + (1 - 1)] + p[(N - 3) * N + (1 + 4)]) +
                0.015625 * (p[(N - 3 - 3) * N + (1 + 1)] + p[(N - 3 - 2) * N + (1 - 1)] + p[(N - 3 - 1) * N + (1 + 3)] + p[(N - 3 + 1) * N + (1 + 3)]) +
                0.0390625 * (p[(N - 3 - 2) * N + (1)]) + 0.0234375 * (p[(N - 3 - 2) * N + (1 + 2)]) + 0.0859375 * (p[(N - 3 - 1) * N + (1 - 1)]) +
                0.078125 * (p[(N - 3 - 1) * N + (1 + 1)]) + 0.296875 * (p[(N - 3) * N + (1 - 1)]) + 0.07421875 * (p[(N - 3) * N + (1)]) +
                0.05859375 * (p[(N - 3) * N + (1 + 2)]) + 0.08203125 * (p[(N - 3 + 1) * N + (1 - 1)] + p[(N - 3 + 2) * N + (1)]) +
                0.0625 * (p[(N - 3 + 1) * N + (1 + 1)]) + 0.03125 * (p[(N - 3 + 2) * N + (1 + 1)]) + 0.01171875 * (p[(N - 3 + 2) * N + (1 + 2)]);
        p_next[(N - 3) * N + 2] =
                0.00390625 * (p[(N - 3 - 4) * N + (2)] + p[(N - 3) * N + (2 + 4)]) +
                0.015625 * (p[(N - 3 - 3) * N + (2 - 1)] + p[(N - 3 - 3) * N + (2 + 1)] + p[(N - 3 - 1) * N + (2 + 3)] + p[(N - 3 + 1) * N + (2 + 3)]) +
                0.01171875 * (p[(N - 3 - 2) * N + (2 - 2)] + p[(N - 3 + 2) * N + (2 + 2)]) +
                0.0625 * (p[(N - 3 - 2) * N + (2)] + p[(N - 3) * N + (2 + 2)] + p[(N - 3 + 1) * N + (2 - 1)]) + 0.0234375 * (p[(N - 3 - 2) * N + (2 + 2)]) +
                0.03125 * (p[(N - 3 - 1) * N + (2 - 2)] + p[(N - 3 + 1) * N + (2 - 2)] + p[(N - 3 + 2) * N + (2 - 1)] + p[(N - 3 + 2) * N + (2 + 1)]) +
                0.078125 * (p[(N - 3 - 1) * N + (2 - 1)] + p[(N - 3 + 1) * N + (2 + 1)]) +
                0.09375 * (p[(N - 3 - 1) * N + (2 + 1)] + p[(N - 3) * N + (2 - 2)] + p[(N - 3 + 2) * N + (2)]) + 0.1328125 * (p[(N - 3) * N + (2)]);
        p_next[(N - 3) * N + 3] =
                0.00390625 * (p[(N - 3 - 4) * N + (3)] + p[(N - 3) * N + (3 + 4)]) +
                0.015625 * (p[(N - 3 - 3) * N + (3 - 1)] + p[(N - 3 - 3) * N + (3 + 1)] + p[(N - 3 - 1) * N + (3 + 3)] + p[(N - 3) * N + (3 - 3)] +
                            p[(N - 3 + 1) * N + (3 + 3)]) +
                0.0234375 * (p[(N - 3 - 2) * N + (3 - 2)] + p[(N - 3 - 2) * N + (3 + 2)]) + 0.0625 * (p[(N - 3 - 2) * N + (3)] + p[(N - 3) * N + (3 + 2)]) +
                0.01171875 * (p[(N - 3 - 1) * N + (3 - 3)] + p[(N - 3 + 1) * N + (3 - 3)] + p[(N - 3 + 2) * N + (3 - 2)] + p[(N - 3 + 2) * N + (3 + 2)]) +
                0.09375 * (p[(N - 3 - 1) * N + (3 - 1)] + p[(N - 3 - 1) * N + (3 + 1)] + p[(N - 3 + 2) * N + (3)]) + 0.05859375 * (p[(N - 3) * N + (3 - 2)]) +
                0.13671875 * (p[(N - 3) * N + (3)]) + 0.078125 * (p[(N - 3 + 1) * N + (3 - 1)] + p[(N - 3 + 1) * N + (3 + 1)]) +
                0.03125 * (p[(N - 3 + 2) * N + (3 - 1)] + p[(N - 3 + 2) * N + (3 + 1)]);
        p_next[(N - 3) * N + N - 4] = 0.00390625 * (p[(N - 3 - 4) * N + (N - 4)] + p[(N - 3) * N + (N - 4 - 4)]) +
                                      0.015625 * (p[(N - 3 - 3) * N + (N - 4 - 1)] + p[(N - 3 - 3) * N + (N - 4 + 1)] + p[(N - 3 - 1) * N + (N - 4 - 3)] +
                                                  p[(N - 3) * N + (N - 4 + 3)] + p[(N - 3 + 1) * N + (N - 4 - 3)]) +
                                      0.0234375 * (p[(N - 3 - 2) * N + (N - 4 - 2)] + p[(N - 3 - 2) * N + (N - 4 + 2)]) +
                                      0.0625 * (p[(N - 3 - 2) * N + (N - 4)] + p[(N - 3) * N + (N - 4 - 2)]) +
                                      0.09375 * (p[(N - 3 - 1) * N + (N - 4 - 1)] + p[(N - 3 - 1) * N + (N - 4 + 1)] + p[(N - 3 + 2) * N + (N - 4)]) +
                                      0.01171875 * (p[(N - 3 - 1) * N + (N - 4 + 3)] + p[(N - 3 + 1) * N + (N - 4 + 3)] + p[(N - 3 + 2) * N + (N - 4 - 2)] +
                                                    p[(N - 3 + 2) * N + (N - 4 + 2)]) +
                                      0.13671875 * (p[(N - 3) * N + (N - 4)]) + 0.05859375 * (p[(N - 3) * N + (N - 4 + 2)]) +
                                      0.078125 * (p[(N - 3 + 1) * N + (N - 4 - 1)] + p[(N - 3 + 1) * N + (N - 4 + 1)]) +
                                      0.03125 * (p[(N - 3 + 2) * N + (N - 4 - 1)] + p[(N - 3 + 2) * N + (N - 4 + 1)]);
        p_next[(N - 3) * N + N - 3] = 0.00390625 * (p[(N - 3 - 4) * N + (N - 3)] + p[(N - 3) * N + (N - 3 - 4)]) +
                                      0.015625 * (p[(N - 3 - 3) * N + (N - 3 - 1)] + p[(N - 3 - 3) * N + (N - 3 + 1)] + p[(N - 3 - 1) * N + (N - 3 - 3)] +
                                                  p[(N - 3 + 1) * N + (N - 3 - 3)]) +
                                      0.0234375 * (p[(N - 3 - 2) * N + (N - 3 - 2)]) +
                                      0.0625 * (p[(N - 3 - 2) * N + (N - 3)] + p[(N - 3) * N + (N - 3 - 2)] + p[(N - 3 + 1) * N + (N - 3 + 1)]) +
                                      0.01171875 * (p[(N - 3 - 2) * N + (N - 3 + 2)] + p[(N - 3 + 2) * N + (N - 3 - 2)]) +
                                      0.09375 * (p[(N - 3 - 1) * N + (N - 3 - 1)] + p[(N - 3) * N + (N - 3 + 2)] + p[(N - 3 + 2) * N + (N - 3)]) +
                                      0.078125 * (p[(N - 3 - 1) * N + (N - 3 + 1)] + p[(N - 3 + 1) * N + (N - 3 - 1)]) +
                                      0.03125 * (p[(N - 3 - 1) * N + (N - 3 + 2)] + p[(N - 3 + 1) * N + (N - 3 + 2)] + p[(N - 3 + 2) * N + (N - 3 - 1)] +
                                                 p[(N - 3 + 2) * N + (N - 3 + 1)]) +
                                      0.1328125 * (p[(N - 3) * N + (N - 3)]);
        p_next[(N - 3) * N + N - 2] = 0.00390625 * (p[(N - 3 - 4) * N + (N - 2)] + p[(N - 3 - 3) * N + (N - 2 + 1)] + p[(N - 3) * N + (N - 2 - 4)]) +
                                      0.015625 * (p[(N - 3 - 3) * N + (N - 2 - 1)] + p[(N - 3 - 2) * N + (N - 2 + 1)] + p[(N - 3 - 1) * N + (N - 2 - 3)] +
                                                  p[(N - 3 + 1) * N + (N - 2 - 3)]) +
                                      0.0234375 * (p[(N - 3 - 2) * N + (N - 2 - 2)]) + 0.0390625 * (p[(N - 3 - 2) * N + (N - 2)]) +
                                      0.078125 * (p[(N - 3 - 1) * N + (N - 2 - 1)]) + 0.0859375 * (p[(N - 3 - 1) * N + (N - 2 + 1)]) +
                                      0.05859375 * (p[(N - 3) * N + (N - 2 - 2)]) + 0.07421875 * (p[(N - 3) * N + (N - 2)]) +
                                      0.296875 * (p[(N - 3) * N + (N - 2 + 1)]) + 0.0625 * (p[(N - 3 + 1) * N + (N - 2 - 1)]) +
                                      0.08203125 * (p[(N - 3 + 1) * N + (N - 2 + 1)] + p[(N - 3 + 2) * N + (N - 2)]) +
                                      0.01171875 * (p[(N - 3 + 2) * N + (N - 2 - 2)]) + 0.03125 * (p[(N - 3 + 2) * N + (N - 2 - 1)]);

        // N - 2
        p_next[(N - 2) * N + 1] =
                0.00390625 * (p[(N - 2 - 4) * N + (1)] + p[(N - 2 - 3) * N + (1 - 1)] + p[(N - 2) * N + (1 + 4)] + p[(N - 2 + 1) * N + (1 + 3)]) +
                0.015625 * (p[(N - 2 - 3) * N + (1 + 1)] + p[(N - 2 - 2) * N + (1 - 1)] + p[(N - 2 - 1) * N + (1 + 3)] + p[(N - 2 + 1) * N + (1 + 2)]) +
                0.03515625 * (p[(N - 2 - 2) * N + (1)] + p[(N - 2) * N + (1 + 2)]) + 0.0234375 * (p[(N - 2 - 2) * N + (1 + 2)]) +
                0.08203125 * (p[(N - 2 - 1) * N + (1 - 1)] + p[(N - 2 + 1) * N + (1 + 1)]) + 0.0625 * (p[(N - 2 - 1) * N + (1 + 1)]) +
                0.28125 * (p[(N - 2) * N + (1 - 1)] + p[(N - 2 + 1) * N + (1)]) + 0.0390625 * (p[(N - 2) * N + (1)]);
        p_next[(N - 2) * N + 2] =
                0.00390625 * (p[(N - 2 - 4) * N + (2)] + p[(N - 2) * N + (2 + 4)] + p[(N - 2 + 1) * N + (2 + 3)]) +
                0.015625 * (p[(N - 2 - 3) * N + (2 - 1)] + p[(N - 2 - 3) * N + (2 + 1)] + p[(N - 2 - 1) * N + (2 + 3)] + p[(N - 2 + 1) * N + (2 + 2)]) +
                0.01171875 * (p[(N - 2 - 2) * N + (2 - 2)]) + 0.05859375 * (p[(N - 2 - 2) * N + (2)]) + 0.0234375 * (p[(N - 2 - 2) * N + (2 + 2)]) +
                0.03125 * (p[(N - 2 - 1) * N + (2 - 2)]) + 0.0625 * (p[(N - 2 - 1) * N + (2 - 1)]) + 0.078125 * (p[(N - 2 - 1) * N + (2 + 1)]) +
                0.08203125 * (p[(N - 2) * N + (2 - 2)] + p[(N - 2 + 1) * N + (2 - 1)]) + 0.07421875 * (p[(N - 2) * N + (2)]) +
                0.0390625 * (p[(N - 2) * N + (2 + 2)]) + 0.296875 * (p[(N - 2 + 1) * N + (2)]) + 0.0859375 * (p[(N - 2 + 1) * N + (2 + 1)]);
        p_next[(N - 2) * N + 3] = 0.00390625 * (p[(N - 2 - 4) * N + (3)] + p[(N - 2) * N + (3 + 4)] + p[(N - 2 + 1) * N + (3 + 3)]) +
                                  0.015625 * (p[(N - 2 - 3) * N + (3 - 1)] + p[(N - 2 - 3) * N + (3 + 1)] + p[(N - 2 - 1) * N + (3 + 3)] +
                                              p[(N - 2) * N + (3 - 3)] + p[(N - 2 + 1) * N + (3 - 2)] + p[(N - 2 + 1) * N + (3 + 2)]) +
                                  0.0234375 * (p[(N - 2 - 2) * N + (3 - 2)] + p[(N - 2 - 2) * N + (3 + 2)]) + 0.05859375 * (p[(N - 2 - 2) * N + (3)]) +
                                  0.01171875 * (p[(N - 2 - 1) * N + (3 - 3)]) +
                                  0.078125 * (p[(N - 2 - 1) * N + (3 - 1)] + p[(N - 2 - 1) * N + (3 + 1)] + p[(N - 2) * N + (3)]) +
                                  0.03515625 * (p[(N - 2) * N + (3 - 2)]) + 0.0390625 * (p[(N - 2) * N + (3 + 2)]) +
                                  0.0859375 * (p[(N - 2 + 1) * N + (3 - 1)] + p[(N - 2 + 1) * N + (3 + 1)]) + 0.296875 * (p[(N - 2 + 1) * N + (3)]);
        p_next[(N - 2) * N + N - 4] =
                0.00390625 * (p[(N - 2 - 4) * N + (N - 4)] + p[(N - 2) * N + (N - 4 - 4)] + p[(N - 2 + 1) * N + (N - 4 - 3)]) +
                0.015625 * (p[(N - 2 - 3) * N + (N - 4 - 1)] + p[(N - 2 - 3) * N + (N - 4 + 1)] + p[(N - 2 - 1) * N + (N - 4 - 3)] +
                            p[(N - 2) * N + (N - 4 + 3)] + p[(N - 2 + 1) * N + (N - 4 - 2)] + p[(N - 2 + 1) * N + (N - 4 + 2)]) +
                0.0234375 * (p[(N - 2 - 2) * N + (N - 4 - 2)] + p[(N - 2 - 2) * N + (N - 4 + 2)]) + 0.05859375 * (p[(N - 2 - 2) * N + (N - 4)]) +
                0.078125 * (p[(N - 2 - 1) * N + (N - 4 - 1)] + p[(N - 2 - 1) * N + (N - 4 + 1)] + p[(N - 2) * N + (N - 4)]) +
                0.01171875 * (p[(N - 2 - 1) * N + (N - 4 + 3)]) + 0.0390625 * (p[(N - 2) * N + (N - 4 - 2)]) + 0.03515625 * (p[(N - 2) * N + (N - 4 + 2)]) +
                0.0859375 * (p[(N - 2 + 1) * N + (N - 4 - 1)] + p[(N - 2 + 1) * N + (N - 4 + 1)]) + 0.296875 * (p[(N - 2 + 1) * N + (N - 4)]);
        p_next[(N - 2) * N + N - 3] = 0.00390625 * (p[(N - 2 - 4) * N + (N - 3)] + p[(N - 2) * N + (N - 3 - 4)] + p[(N - 2 + 1) * N + (N - 3 - 3)]) +
                                      0.015625 * (p[(N - 2 - 3) * N + (N - 3 - 1)] + p[(N - 2 - 3) * N + (N - 3 + 1)] + p[(N - 2 - 1) * N + (N - 3 - 3)] +
                                                  p[(N - 2 + 1) * N + (N - 3 - 2)]) +
                                      0.0234375 * (p[(N - 2 - 2) * N + (N - 3 - 2)]) + 0.05859375 * (p[(N - 2 - 2) * N + (N - 3)]) +
                                      0.01171875 * (p[(N - 2 - 2) * N + (N - 3 + 2)]) + 0.078125 * (p[(N - 2 - 1) * N + (N - 3 - 1)]) +
                                      0.0625 * (p[(N - 2 - 1) * N + (N - 3 + 1)]) + 0.03125 * (p[(N - 2 - 1) * N + (N - 3 + 2)]) +
                                      0.0390625 * (p[(N - 2) * N + (N - 3 - 2)]) + 0.07421875 * (p[(N - 2) * N + (N - 3)]) +
                                      0.08203125 * (p[(N - 2) * N + (N - 3 + 2)] + p[(N - 2 + 1) * N + (N - 3 + 1)]) +
                                      0.0859375 * (p[(N - 2 + 1) * N + (N - 3 - 1)]) + 0.296875 * (p[(N - 2 + 1) * N + (N - 3)]);
        p_next[(N - 2) * N + N - 2] =
                0.00390625 *
                (p[(N - 2 - 4) * N + (N - 2)] + p[(N - 2 - 3) * N + (N - 2 + 1)] + p[(N - 2) * N + (N - 2 - 4)] + p[(N - 2 + 1) * N + (N - 2 - 3)]) +
                0.015625 * (p[(N - 2 - 3) * N + (N - 2 - 1)] + p[(N - 2 - 2) * N + (N - 2 + 1)] + p[(N - 2 - 1) * N + (N - 2 - 3)] +
                            p[(N - 2 + 1) * N + (N - 2 - 2)]) +
                0.0234375 * (p[(N - 2 - 2) * N + (N - 2 - 2)]) + 0.03515625 * (p[(N - 2 - 2) * N + (N - 2)] + p[(N - 2) * N + (N - 2 - 2)]) +
                0.0625 * (p[(N - 2 - 1) * N + (N - 2 - 1)]) + 0.08203125 * (p[(N - 2 - 1) * N + (N - 2 + 1)] + p[(N - 2 + 1) * N + (N - 2 - 1)]) +
                0.0390625 * (p[(N - 2) * N + (N - 2)]) + 0.28125 * (p[(N - 2) * N + (N - 2 + 1)] + p[(N - 2 + 1) * N + (N - 2)]);

        // edge
#pragma omp parallel for
        for (j = 4; j < N - 4; ++j) {
            p_next[N + j] =
                    0.00390625 * (p[(1 - 1) * N + (j - 3)] + p[(1 - 1) * N + (j + 3)] + p[(1) * N + (j - 4)] + p[(1) * N + (j + 4)] + p[(1 + 4) * N + (j)]) +
                    0.015625 * (p[(1 - 1) * N + (j - 2)] + p[(1 - 1) * N + (j + 2)] + p[(1 + 1) * N + (j - 3)] + p[(1 + 1) * N + (j + 3)] +
                                p[(1 + 3) * N + (j - 1)] + p[(1 + 3) * N + (j + 1)]) +
                    0.0859375 * (p[(1 - 1) * N + (j - 1)] + p[(1 - 1) * N + (j + 1)]) + 0.296875 * (p[(1 - 1) * N + (j)]) +
                    0.0390625 * (p[(1) * N + (j - 2)] + p[(1) * N + (j + 2)]) +
                    0.078125 * (p[(1) * N + (j)] + p[(1 + 1) * N + (j - 1)] + p[(1 + 1) * N + (j + 1)]) +
                    0.0234375 * (p[(1 + 2) * N + (j - 2)] + p[(1 + 2) * N + (j + 2)]) + 0.05859375 * (p[(1 + 2) * N + (j)]);
            p_next[2 * N + j] = 0.01171875 * (p[(2 - 2) * N + (j - 2)] + p[(2 - 2) * N + (j + 2)]) +
                                0.03125 * (p[(2 - 2) * N + (j - 1)] + p[(2 - 2) * N + (j + 1)]) +
                                0.09375 * (p[(2 - 2) * N + (j)] + p[(2 + 1) * N + (j - 1)] + p[(2 + 1) * N + (j + 1)]) +
                                0.015625 * (p[(2 - 1) * N + (j - 3)] + p[(2 - 1) * N + (j + 3)] + p[(2 + 1) * N + (j - 3)] + p[(2 + 1) * N + (j + 3)] +
                                            p[(2 + 3) * N + (j - 1)] + p[(2 + 3) * N + (j + 1)]) +
                                0.078125 * (p[(2 - 1) * N + (j - 1)] + p[(2 - 1) * N + (j + 1)]) +
                                0.00390625 * (p[(2) * N + (j - 4)] + p[(2) * N + (j + 4)] + p[(2 + 4) * N + (j)]) +
                                0.0625 * (p[(2) * N + (j - 2)] + p[(2) * N + (j + 2)] + p[(2 + 2) * N + (j)]) + 0.13671875 * (p[(2) * N + (j)]) +
                                0.0234375 * (p[(2 + 2) * N + (j - 2)] + p[(2 + 2) * N + (j + 2)]);
            p_next[3 * N + j] = 0.01171875 * (p[(3 - 3) * N + (j - 1)] + p[(3 - 3) * N + (j + 1)]) +
                                0.015625 * (p[(3 - 3) * N + (j)] + p[(3 - 1) * N + (j - 3)] + p[(3 - 1) * N + (j + 3)] + p[(3 + 1) * N + (j - 3)] +
                                            p[(3 + 1) * N + (j + 3)] + p[(3 + 3) * N + (j - 1)] + p[(3 + 3) * N + (j + 1)]) +
                                0.0234375 * (p[(3 - 2) * N + (j - 2)] + p[(3 - 2) * N + (j + 2)] + p[(3 + 2) * N + (j - 2)] + p[(3 + 2) * N + (j + 2)]) +
                                0.05859375 * (p[(3 - 2) * N + (j)]) +
                                0.09375 * (p[(3 - 1) * N + (j - 1)] + p[(3 - 1) * N + (j + 1)] + p[(3 + 1) * N + (j - 1)] + p[(3 + 1) * N + (j + 1)]) +
                                0.00390625 * (p[(3) * N + (j - 4)] + p[(3) * N + (j + 4)] + p[(3 + 4) * N + (j)]) +
                                0.0625 * (p[(3) * N + (j - 2)] + p[(3) * N + (j + 2)] + p[(3 + 2) * N + (j)]) + 0.140625 * (p[(3) * N + (j)]);
            p_next[(N - 4) * N + j] =
                    0.00390625 * (p[(N - 4 - 4) * N + (j)] + p[(N - 4) * N + (j - 4)] + p[(N - 4) * N + (j + 4)]) +
                    0.015625 * (p[(N - 4 - 3) * N + (j - 1)] + p[(N - 4 - 3) * N + (j + 1)] + p[(N - 4 - 1) * N + (j - 3)] + p[(N - 4 - 1) * N + (j + 3)] +
                                p[(N - 4 + 1) * N + (j - 3)] + p[(N - 4 + 1) * N + (j + 3)] + p[(N - 4 + 3) * N + (j)]) +
                    0.0234375 * (p[(N - 4 - 2) * N + (j - 2)] + p[(N - 4 - 2) * N + (j + 2)] + p[(N - 4 + 2) * N + (j - 2)] + p[(N - 4 + 2) * N + (j + 2)]) +
                    0.0625 * (p[(N - 4 - 2) * N + (j)] + p[(N - 4) * N + (j - 2)] + p[(N - 4) * N + (j + 2)]) +
                    0.09375 * (p[(N - 4 - 1) * N + (j - 1)] + p[(N - 4 - 1) * N + (j + 1)] + p[(N - 4 + 1) * N + (j - 1)] + p[(N - 4 + 1) * N + (j + 1)]) +
                    0.140625 * (p[(N - 4) * N + (j)]) + 0.05859375 * (p[(N - 4 + 2) * N + (j)]) +
                    0.01171875 * (p[(N - 4 + 3) * N + (j - 1)] + p[(N - 4 + 3) * N + (j + 1)]);
            p_next[(N - 3) * N + j] = 0.00390625 * (p[(N - 3 - 4) * N + (j)] + p[(N - 3) * N + (j - 4)] + p[(N - 3) * N + (j + 4)]) +
                                      0.015625 * (p[(N - 3 - 3) * N + (j - 1)] + p[(N - 3 - 3) * N + (j + 1)] + p[(N - 3 - 1) * N + (j - 3)] +
                                                  p[(N - 3 - 1) * N + (j + 3)] + p[(N - 3 + 1) * N + (j - 3)] + p[(N - 3 + 1) * N + (j + 3)]) +
                                      0.0234375 * (p[(N - 3 - 2) * N + (j - 2)] + p[(N - 3 - 2) * N + (j + 2)]) +
                                      0.0625 * (p[(N - 3 - 2) * N + (j)] + p[(N - 3) * N + (j - 2)] + p[(N - 3) * N + (j + 2)]) +
                                      0.09375 * (p[(N - 3 - 1) * N + (j - 1)] + p[(N - 3 - 1) * N + (j + 1)] + p[(N - 3 + 2) * N + (j)]) +
                                      0.13671875 * (p[(N - 3) * N + (j)]) + 0.078125 * (p[(N - 3 + 1) * N + (j - 1)] + p[(N - 3 + 1) * N + (j + 1)]) +
                                      0.01171875 * (p[(N - 3 + 2) * N + (j - 2)] + p[(N - 3 + 2) * N + (j + 2)]) +
                                      0.03125 * (p[(N - 3 + 2) * N + (j - 1)] + p[(N - 3 + 2) * N + (j + 1)]);
            p_next[(N - 2) * N + j] = 0.00390625 * (p[(N - 2 - 4) * N + (j)] + p[(N - 2) * N + (j - 4)] + p[(N - 2) * N + (j + 4)] +
                                                    p[(N - 2 + 1) * N + (j - 3)] + p[(N - 2 + 1) * N + (j + 3)]) +
                                      0.015625 * (p[(N - 2 - 3) * N + (j - 1)] + p[(N - 2 - 3) * N + (j + 1)] + p[(N - 2 - 1) * N + (j - 3)] +
                                                  p[(N - 2 - 1) * N + (j + 3)] + p[(N - 2 + 1) * N + (j - 2)] + p[(N - 2 + 1) * N + (j + 2)]) +
                                      0.0234375 * (p[(N - 2 - 2) * N + (j - 2)] + p[(N - 2 - 2) * N + (j + 2)]) + 0.05859375 * (p[(N - 2 - 2) * N + (j)]) +
                                      0.078125 * (p[(N - 2 - 1) * N + (j - 1)] + p[(N - 2 - 1) * N + (j + 1)] + p[(N - 2) * N + (j)]) +
                                      0.0390625 * (p[(N - 2) * N + (j - 2)] + p[(N - 2) * N + (j + 2)]) +
                                      0.0859375 * (p[(N - 2 + 1) * N + (j - 1)] + p[(N - 2 + 1) * N + (j + 1)]) + 0.296875 * (p[(N - 2 + 1) * N + (j)]);
        }
#pragma omp parallel for
        for (i = 4; i < N - 4; ++i) {
            p_next[i * N + 1] =
                    0.00390625 * (p[(i - 4) * N + (1)] + p[(i - 3) * N + (1 - 1)] + p[(i) * N + (1 + 4)] + p[(i + 3) * N + (1 - 1)] + p[(i + 4) * N + (1)]) +
                    0.015625 * (p[(i - 3) * N + (1 + 1)] + p[(i - 2) * N + (1 - 1)] + p[(i - 1) * N + (1 + 3)] + p[(i + 1) * N + (1 + 3)] +
                                p[(i + 2) * N + (1 - 1)] + p[(i + 3) * N + (1 + 1)]) +
                    0.0390625 * (p[(i - 2) * N + (1)] + p[(i + 2) * N + (1)]) + 0.0234375 * (p[(i - 2) * N + (1 + 2)] + p[(i + 2) * N + (1 + 2)]) +
                    0.0859375 * (p[(i - 1) * N + (1 - 1)] + p[(i + 1) * N + (1 - 1)]) +
                    0.078125 * (p[(i - 1) * N + (1 + 1)] + p[(i) * N + (1)] + p[(i + 1) * N + (1 + 1)]) + 0.296875 * (p[(i) * N + (1 - 1)]) +
                    0.05859375 * (p[(i) * N + (1 + 2)]);
            p_next[i * N + 2] = 0.00390625 * (p[(i - 4) * N + (2)] + p[(i) * N + (2 + 4)] + p[(i + 4) * N + (2)]) +
                                0.015625 * (p[(i - 3) * N + (2 - 1)] + p[(i - 3) * N + (2 + 1)] + p[(i - 1) * N + (2 + 3)] + p[(i + 1) * N + (2 + 3)] +
                                            p[(i + 3) * N + (2 - 1)] + p[(i + 3) * N + (2 + 1)]) +
                                0.01171875 * (p[(i - 2) * N + (2 - 2)] + p[(i + 2) * N + (2 - 2)]) +
                                0.0625 * (p[(i - 2) * N + (2)] + p[(i) * N + (2 + 2)] + p[(i + 2) * N + (2)]) +
                                0.0234375 * (p[(i - 2) * N + (2 + 2)] + p[(i + 2) * N + (2 + 2)]) +
                                0.03125 * (p[(i - 1) * N + (2 - 2)] + p[(i + 1) * N + (2 - 2)]) +
                                0.078125 * (p[(i - 1) * N + (2 - 1)] + p[(i + 1) * N + (2 - 1)]) +
                                0.09375 * (p[(i - 1) * N + (2 + 1)] + p[(i) * N + (2 - 2)] + p[(i + 1) * N + (2 + 1)]) + 0.13671875 * (p[(i) * N + (2)]);
            p_next[i * N + 3] = 0.00390625 * (p[(i - 4) * N + (3)] + p[(i) * N + (3 + 4)] + p[(i + 4) * N + (3)]) +
                                0.015625 * (p[(i - 3) * N + (3 - 1)] + p[(i - 3) * N + (3 + 1)] + p[(i - 1) * N + (3 + 3)] + p[(i) * N + (3 - 3)] +
                                            p[(i + 1) * N + (3 + 3)] + p[(i + 3) * N + (3 - 1)] + p[(i + 3) * N + (3 + 1)]) +
                                0.0234375 * (p[(i - 2) * N + (3 - 2)] + p[(i - 2) * N + (3 + 2)] + p[(i + 2) * N + (3 - 2)] + p[(i + 2) * N + (3 + 2)]) +
                                0.0625 * (p[(i - 2) * N + (3)] + p[(i) * N + (3 + 2)] + p[(i + 2) * N + (3)]) +
                                0.01171875 * (p[(i - 1) * N + (3 - 3)] + p[(i + 1) * N + (3 - 3)]) +
                                0.09375 * (p[(i - 1) * N + (3 - 1)] + p[(i - 1) * N + (3 + 1)] + p[(i + 1) * N + (3 - 1)] + p[(i + 1) * N + (3 + 1)]) +
                                0.05859375 * (p[(i) * N + (3 - 2)]) + 0.140625 * (p[(i) * N + (3)]);
            p_next[i * N + N - 4] =
                    0.00390625 * (p[(i - 4) * N + (N - 4)] + p[(i) * N + (N - 4 - 4)] + p[(i + 4) * N + (N - 4)]) +
                    0.015625 * (p[(i - 3) * N + (N - 4 - 1)] + p[(i - 3) * N + (N - 4 + 1)] + p[(i - 1) * N + (N - 4 - 3)] + p[(i) * N + (N - 4 + 3)] +
                                p[(i + 1) * N + (N - 4 - 3)] + p[(i + 3) * N + (N - 4 - 1)] + p[(i + 3) * N + (N - 4 + 1)]) +
                    0.0234375 * (p[(i - 2) * N + (N - 4 - 2)] + p[(i - 2) * N + (N - 4 + 2)] + p[(i + 2) * N + (N - 4 - 2)] + p[(i + 2) * N + (N - 4 + 2)]) +
                    0.0625 * (p[(i - 2) * N + (N - 4)] + p[(i) * N + (N - 4 - 2)] + p[(i + 2) * N + (N - 4)]) +
                    0.09375 * (p[(i - 1) * N + (N - 4 - 1)] + p[(i - 1) * N + (N - 4 + 1)] + p[(i + 1) * N + (N - 4 - 1)] + p[(i + 1) * N + (N - 4 + 1)]) +
                    0.01171875 * (p[(i - 1) * N + (N - 4 + 3)] + p[(i + 1) * N + (N - 4 + 3)]) + 0.140625 * (p[(i) * N + (N - 4)]) +
                    0.05859375 * (p[(i) * N + (N - 4 + 2)]);
            p_next[i * N + N - 3] = 0.00390625 * (p[(i - 4) * N + (N - 3)] + p[(i) * N + (N - 3 - 4)] + p[(i + 4) * N + (N - 3)]) +
                                    0.015625 * (p[(i - 3) * N + (N - 3 - 1)] + p[(i - 3) * N + (N - 3 + 1)] + p[(i - 1) * N + (N - 3 - 3)] +
                                                p[(i + 1) * N + (N - 3 - 3)] + p[(i + 3) * N + (N - 3 - 1)] + p[(i + 3) * N + (N - 3 + 1)]) +
                                    0.0234375 * (p[(i - 2) * N + (N - 3 - 2)] + p[(i + 2) * N + (N - 3 - 2)]) +
                                    0.0625 * (p[(i - 2) * N + (N - 3)] + p[(i) * N + (N - 3 - 2)] + p[(i + 2) * N + (N - 3)]) +
                                    0.01171875 * (p[(i - 2) * N + (N - 3 + 2)] + p[(i + 2) * N + (N - 3 + 2)]) +
                                    0.09375 * (p[(i - 1) * N + (N - 3 - 1)] + p[(i) * N + (N - 3 + 2)] + p[(i + 1) * N + (N - 3 - 1)]) +
                                    0.078125 * (p[(i - 1) * N + (N - 3 + 1)] + p[(i + 1) * N + (N - 3 + 1)]) +
                                    0.03125 * (p[(i - 1) * N + (N - 3 + 2)] + p[(i + 1) * N + (N - 3 + 2)]) + 0.13671875 * (p[(i) * N + (N - 3)]);
            p_next[i * N + N - 2] = 0.00390625 * (p[(i - 4) * N + (N - 2)] + p[(i - 3) * N + (N - 2 + 1)] + p[(i) * N + (N - 2 - 4)] +
                                                  p[(i + 3) * N + (N - 2 + 1)] + p[(i + 4) * N + (N - 2)]) +
                                    0.015625 * (p[(i - 3) * N + (N - 2 - 1)] + p[(i - 2) * N + (N - 2 + 1)] + p[(i - 1) * N + (N - 2 - 3)] +
                                                p[(i + 1) * N + (N - 2 - 3)] + p[(i + 2) * N + (N - 2 + 1)] + p[(i + 3) * N + (N - 2 - 1)]) +
                                    0.0234375 * (p[(i - 2) * N + (N - 2 - 2)] + p[(i + 2) * N + (N - 2 - 2)]) +
                                    0.0390625 * (p[(i - 2) * N + (N - 2)] + p[(i + 2) * N + (N - 2)]) +
                                    0.078125 * (p[(i - 1) * N + (N - 2 - 1)] + p[(i) * N + (N - 2)] + p[(i + 1) * N + (N - 2 - 1)]) +
                                    0.0859375 * (p[(i - 1) * N + (N - 2 + 1)] + p[(i + 1) * N + (N - 2 + 1)]) + 0.05859375 * (p[(i) * N + (N - 2 - 2)]) +
                                    0.296875 * (p[(i) * N + (N - 2 + 1)]);
        }

        temp = p;
        p = p_next;
        p_next = temp;
    }


    if (stp % 2 == 0) {
        for (k = k * 4; k < step; ++k) {
#pragma omp parallel for
            for (i = 1; i < N - 1; ++i) {
                j_begin = 1 + ((k & 1) ^ (i & 1));
                for (j = j_begin; j < N - 1; j += 2) {
                    p[i * N + j] = (p[(i - 1) * N + j] + p[i * N + j - 1] + p[i * N + j + 1] + p[(i + 1) * N + j]) * 0.25;
                }
            }
        }
        free(p_next);
    } else {
        for (k = k * 4; k < step; ++k) {
#pragma omp parallel for
            for (i = 1; i < N - 1; ++i) {
                j_begin = 1 + ((k & 1) ^ (i & 1));
                for (j = j_begin; j < N - 1; j += 2) {
                    p_next[i * N + j] = (p_next[(i - 1) * N + j] + p_next[i * N + j - 1] + p_next[i * N + j + 1] + p_next[(i + 1) * N + j]) * 0.25;
                }
            }
        }
        free(p);
    }
}
